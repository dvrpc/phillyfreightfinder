$(function(){function a(){function a(){function a(a){var b=i(parseInt(a[0])),c=i(parseInt(a[1]));$("#hp-t1").html(b),$("#hp-t2").html(c)}function i(a){switch(a){case 5:return'5 <span class="hp_tod">AM</span>';case 7:return'7 <span class="hp_tod">AM</span>';case 9:return'9 <span class="hp_tod">AM</span>';case 11:return'11 <span class="hp_tod">AM</span>';case 13:return'1 <span class="hp_tod">PM</span>';case 15:return'3 <span class="hp_tod">PM</span>';case 17:return'5 <span class="hp_tod">PM</span>';case 19:return'7 <span class="hp_tod">PM</span>';default:return'12 <span class="hp_tod">AM</span>'}}function k(){c=L.map("hp-map-wrapper",{minZoom:9,maxZoom:14,zoomControl:!1}).setView([oLat,oLng],10),L.esri.basemapLayer("Gray").addTo(c),c.addControl(new L.Control.mapCenter),c.attributionControl.addAttribution("<b>Performance Measures:</b> DVRPC analysis of NPMRDS truck prode data.");var a=L.esri.tiledMapLayer({url:"http://arcgis.dvrpc.org/arcgis/rest/services/Freight/"+e+j[f]+"/MapServer",maxZoom:14});h=[L.layerGroup().addTo(c),L.layerGroup().addTo(c),L.layerGroup().addTo(c)],h[g].clearLayers().addLayer(a)}d=document.getElementById("hp_timing_slider"),noUiSlider.create(d,{start:[0,5],connect:!0,snap:!0,behaviour:"tap",range:{min:0,"20%":5,"28%":7,"36%":9,"44%":11,"52%":13,"60%":15,"68%":17,"76%":19,max:24},pips:{mode:"range",density:4}}),$(".noUi-value.noUi-value-horizontal.noUi-value-large").each(function(){var a=$(this).html();a=i(parseInt(a)),$(this).html(a)});var l=0,m=5;d.noUiSlider.on("slide",function(a,b){var c=parseInt(a[1]),e=parseInt(a[0]);if(c>m||m>c)if(5>=c)d.noUiSlider.set([0,5]),m=5,l=0;else if(c>5&&19>=c){var f=c-2;d.noUiSlider.set([f,c]),m=c,l=f}else d.noUiSlider.set([19,24]),m=24,l=19;else if(l>e||e>l)if(5>e)d.noUiSlider.set([0,5]),m=5,l=0;else if(e>=5&&19>e){var g=e+2;d.noUiSlider.set([e,g]),m=g,l=e}else d.noUiSlider.set([19,24]),m=24,l=19}),d.noUiSlider.on("change",function(a,c){b()}),d.noUiSlider.on("set",function(b,c){a(b)}),$.getScript("//cdn.jsdelivr.net/leaflet.esri/1.0.0/esri-leaflet.js",k)}$("#hp-map-wrapper").css("height",k+"px"),$.getScript("lib/tools/assets/nouislider.js",a)}function b(){function a(){for(i=0;i<h.length;i++)i!=g&&h[i].clearLayers()}var b=$(this).attr("name");if("hp_measure"===b){e=$(this).val();var c=$(this).parent().text();$("#hp_title_metric").html("Truck "+c),$(".hp_legend_wrapper").toggleClass("hidden")}else{var k=d.noUiSlider.get();f=parseInt(k[0]).toFixed(0)}var l=e+j[f];g=2===g?0:g+1;var m=L.esri.tiledMapLayer({url:"http://arcgis.dvrpc.org/arcgis/rest/services/Freight/"+l+"/MapServer",maxZoom:14});h[g].clearLayers().addLayer(m),m.on("load",function(){setTimeout(a,500)})}executeOnLoad("hp_timing_slider",a);var c,d,e="TTI",f="0",g=0,h=[],j={0:"_0_5",5:"_5_7",7:"_7_9",9:"_9_11",11:"_11_13",13:"_13_15",15:"_15_17",17:"_17_19",19:"_19_24"},k=$(window).height()-335;$(document.body).on("change","#hp_timing_select input",b),$(document.body).on("change","#hp_select input",b);var l;playing=function(){l=window.setInterval(function(){var a=d.noUiSlider.get(),c=parseInt(a[1])+2;19>=c?(d.noUiSlider.set([a[1],c]),b()):c>19&&24>c?(d.noUiSlider.set([19,24]),b()):(d.noUiSlider.set([0,5]),b())},2e3)},$(document.body).on("click",".hp_play",function(){$(this).toggleClass("hp_play hp_pause").html('<i class="glyphicon glyphicon-pause"></i>&nbsp;&nbsp;Pause'),playing()}),$(document.body).on("click",".hp_pause",function(){$(this).toggleClass("hp_pause hp_play").html('<i class="glyphicon glyphicon-play"></i>&nbsp;&nbsp;Play'),clearInterval(l)}),$(document.body).on("mouseup",".hp_filter .btn",function(){$(this).blur()}),$(document.body).on("click","#hp_prev",function(){var a=d.noUiSlider.get(),c=parseInt(a[0])-2;19>=c&&parseInt(a[0])>5?(d.noUiSlider.set([c,a[0]]),b()):0===parseInt(a[0])?(d.noUiSlider.set([19,24]),b()):(d.noUiSlider.set([0,5]),b())}),$(document.body).on("click","#hp_next",function(){clearInterval(l);var a=d.noUiSlider.get(),c=parseInt(a[1])+2;19>=c?(d.noUiSlider.set([a[1],c]),b()):c>19&&24>c?(d.noUiSlider.set([19,24]),b()):(d.noUiSlider.set([0,5]),b())})});